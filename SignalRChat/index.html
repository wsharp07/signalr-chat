<!DOCTYPE html>
<html>
<head>
    <title>SignalR Simple Chat</title>
    <style type="text/css">
        .container {
            background-color: #99CCFF;
            border: thick solid #808080;
            padding: 20px;
            margin: 20px;
        }
    </style>
</head>
<body>

    <p>I'm a server, beep boop</p>
    <label for="username">Your Username</label>
    <input type="text" readonly="readonly" id="username" name="username" disabled="disabled" />


    <div id="messageContainer">

        <label for="recipient">Recipient</label>
        <input type="text" id="recipient" name="recipient" />
        <br />
        <label for="message">Message</label>
        <input type="text" id="message" name="message" />
        <br />
        <button type="button" id="sendMessage">Send Broadcast Message</button>
        <button type="button" id="sendDirectMessage">Send Direct Message</button>
    </div>


    <ul id="discussion"></ul>
    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="Scripts/jquery.signalR-2.2.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        var username = "";
        $(function () {
            // Declare a proxy to reference the hub.
            var chatProxy = $.connection.chatHub;

            // Get the user name and store it to prepend to messages
            username = prompt('Enter your name:', '');
            $.connection.hub.qs = { "username": username };

            // Create a function that the hub can call to broadcast messages.
            chatProxy.client.broadcastMessage = function (chatMessage) {
                // Html encode display name and message.
                var encodedName = $('<div />').text(chatMessage.FromUsername).html();
                var encodedMsg = $('<div />').text(chatMessage.Message).html();
                // Add the message to the page.
                $('#discussion').append('<li><strong>' + encodedName + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');
            };

            chatProxy.client.directMessage = function (chatMessage) {
                // Html encode display name and message.
                var encodedName = $('<div />').text(chatMessage.FromUsername).html();
                var encodedMsg = $('<div />').text(chatMessage.Message).html();
                // Add the message to the page.
                $('#discussion').append('<li><strong>' + encodedName + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');
            };

            $('#username').val(username);
            // Set initial focus to message input box.
            $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#sendMessage').click(function () {
                    var message = $("#message").val().trim();

                    if (message === "") {
                        alert("You must provide a message");
                        return false;
                    }
                    var request = { 'fromUsername': username, 'message': message };
                    // Call the Send method on the hub.
                    chatProxy.server.sendBroadcastMessage(request);
                    // Clear text box and reset focus for next comment.
                    $('#message').val('').focus();
                });

                $('#sendDirectMessage').click(function () {
                    var toUsername = $("#recipient").val().trim();
                    var message = $("#message").val().trim();

                    if (toUsername === "") {
                        alert("You must provide a recipient");
                        return false;
                    }

                    if (message === "") {
                        alert("You must provide a message");
                        return false;
                    }

                    var request = { 'fromUsername': username, 'message': message };
                    // Call the Send method on the hub.
                    chatProxy.server.sendDirectMessage(toUsername, request);
                    // Clear text box and reset focus for next comment.
                    $('#message').val('').focus();
                });
            });
        });
    </script>
</body>
</html>